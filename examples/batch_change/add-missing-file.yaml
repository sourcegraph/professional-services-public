version: 2
name: add-readme
description: Add a README.md file to repositories that do not have one present.

# Find the first 100 search results for README files.
# This could yield less than 100 repos/workspaces if some repos contain multiple READMEs.
on:
  - repositoriesMatchingQuery: -repo:has.file(^README\.md$) repo:^github.com\/sourcegraph\/.*$

# In each repository, run this command. Each repository's resulting diff is captured.
steps:
  - run: |
      echo "# ${repository.name}}\n" > README.md
      echo "This README was generated by a Sourcegraph Batch Change [${{batch_change.name}}]\n\n" >> README.md
      echo "${{batch_change.description}}\n\n" >> README.md
    container: ubuntu:18.04

# Describe the changeset (e.g., GitHub pull request) you want for each repository.
changesetTemplate:
  title: Added README.md
  body: Added README.md to repository, see ${{batch_change_link}} for more details.
  commit:
    message: Added README.md via Sourcegraph batch change ${{batch_change_link}}
  # Optional: Push the commit to a branch named after this batch change by default.
  branch: ${{ batch_change.name }}